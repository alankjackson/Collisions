---
title: "Pedestrian/Auto Collisions"
author: "Alan K Jackson"
date: "May 8, 2018"
output: html_document
---

```{r setup, include=FALSE}

library(dplyr)
library(htmltools)
library(lubridate)
library(ggplot2)

collisions <- readRDS("~/Dropbox/Rprojects/Collisions/Collisions_2010_2017nozip.rds")
HoustonBoundary <- c(-95.789963, 29.518566, -95.005814, 30.117875)

#   Pull out Peds 
peds <- collisions %>% filter(Harmed=="Pedestrian", !is.na(Latitude)) 

#   Create a lat/long hash to group on
peds <- peds %>% 
  mutate(latlon=paste(as.character(Longitude), as.character(Latitude)))

#   set ordering for severity and road type
peds$Severity <-  factor(peds$Severity, levels=c("UNKNOWN", "NOT INJURED", "POSSIBLE INJURY", "NON-INCAPACITATING", "SUSPECTED SERIOUS INJURY", "FATAL"))

SevereColor <- c("UNKNOWN"="gray", "NOT INJURED"="green", "POSSIBLE INJURY"="turquoise3", "NON-INCAPACITATING"="purple", "SUSPECTED SERIOUS INJURY"="orange", "FATAL"="red")

peds$RoadType <-  factor(peds$RoadType, levels=c("OTHER ROADS", "CITY STREET", "COUNTY ROAD", "FARM TO MARKET", "TOLLWAY", "US & STATE HIGHWAYS","INTERSTATE"))


knitr::opts_chunk$set(echo = TRUE)
```

## Pedestrian/Automobile Incidents in Harris County

Based on the TxDOT data from 2010 to 2017, I have analyzed incidents where pedestrians got hit by cars. First we will begin with some general statistics, and then bore down to some more specific items.  

## Injury Distribution

```{r overall, echo=FALSE}

peds %>% 
  ggplot(aes(x=Severity)) +
  geom_bar(fill=SevereColor) +
  geom_label(aes(label=..count..), stat='count', size = 3) +
  coord_flip() +
  labs(title="Pedestrian/Auto Incidents in Harris County, 2010-2017")
```

## Injuries as a function of road type

It seems obvious that if you get hit on the freeway, you are more likely to die, but let's test that hypothesis, just to be sure.  

```{r Injuries vs. RoadType, echo=FALSE}
peds %>% ggplot() +
  geom_bar(aes(x=RoadType, fill=Severity), position="dodge" ) +
  coord_flip() +
  scale_fill_manual("Severity",values = c("gray", "green", "turquoise3", "purple", "orange", "red")) +
  labs(title="Pedestrian/Automobile Collisions in Harris County, 2010-2017")
```

## Maps

Let's make some maps

```{r Mapping Prep, echo=FALSE}

#   Pull out Peds with geocoding
peds <- collisions %>% filter(!is.na(Latitude)) 

#   Create a lat/long hash to group on
peds <- peds %>% 
  mutate(latlon=paste(as.character(Longitude), as.character(Latitude)))
```

